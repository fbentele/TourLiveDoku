\chapter{Schnittstellen}

Das Aufnahmesystem kommuniziert mit beiden Serversystemen in beide Richtungen. In diesem Kapitel werden die Schnittstellen zwischen Aufnahmesystem,  Tourlive Server sowie Devicemanagement Portal erläutert.
 

\section{TourLive Server Schnittstelle}

{\renewcommand{\arraystretch}{1.5}%
    \begin{longtable}{ p{2.5cm}  p{10cm}}

	\textbf{URL:} & /api/valuecontainer \\
	\textbf{Request:} & POST: JSON/ValueContainer \\
	\textbf{Response:} & ?  \\
	\textbf{Interval:} & einstellbar \\
	\textbf{Zeitpunkt:} & Bei laufender Aufnahme \\ 
\hline
\hline
	\textbf{URL:} & /api/image \\
	\textbf{Request:} & Method: POST
		\newline Content-Type: multipart/form-data [3 Boundaries]
		\newline Body-Boundary 1: text/plain (timestamp)
		\newline Body-Boundary 2: text/plain (deviceId)
		\newline Body-Boundary 3: application/octet-stream (Bild)\\
	\textbf{Response:} &  Header: HTTP/1.1 200 OK
		\newline Body: <empty>	\\
	\textbf{Zeitpunkt:} & Bei laufender Aufnahme, falls Image aktiviert ist \\ 
	\textbf{Interval:} & einstellbar \\
\hline
\hline
	\textbf{URL:} & /api/video \\
	\textbf{Request:} & POST: Multi Part Form Data \\
	\textbf{Response:} & ?  \\
	\textbf{Interval:} & einstellbar \\
	\textbf{Zeitpunkt:} & Bei laufender Aufnahme, falls der Videostream aktiviert ist \\ 
\hline
\hline
	\textbf{URL:} & /api/racedata \\
	\textbf{Request:} & GET \\
	\textbf{Response:} & JSON/ RaceData  \\
	\textbf{Interval:} & 60 Sekunden \\
	\textbf{Zeitpunkt:} & immer \\ 
\hline
\hline 
\caption{Schnittstellen TourLiveServer Übersicht}
\end{longtable} }
TODO FLO

\section{Device Management Portal Schnittstelle}

{\renewcommand{\arraystretch}{1.5}%
    \begin{longtable}{ p{2.5cm}  p{10cm}}
	\textbf{URL:} & /devmgmtsrv/api/postdevicemanagementcontainer \\
	\textbf{Request:} & 
	
{\renewcommand{\arraystretch}{1}%
		\begin{tabular}{ll}
		Method: & POST \\
		Content-Type: & application/json \\
		Body: & JSON-String 'DeviceManagementContainer'
		\end{tabular} } \\
	\textbf{Response:} &  Header: HTTP/1.1 200 OK
		\newline Body: <empty>	\\
	\textbf{Eigenschaft:} & Wird einmalig beim App Start ausgeführt sowie bei lokalen Änderungen in den Einstellungen \\
	\textbf{Interval:} & unregelmässig\\
\hline
\hline    
	\textbf{URL:} & /devmgmtsrv/api/getdevicemanagementcontainer \\
	\textbf{Request:} & Content-Type: application/json
		\newline Method: POST
		\newline Body: JSON-String 'StatusData' \\
	\textbf{Response:} & Method: POST
		\newline Content-Type: application/json
		\newline Body: JSON-String 'DeviceManagementContainer' \\
	\textbf{Eigenschaft:} & Wird regelmässig als Service ausgeführt. \\ 
	\textbf{Interval:} & regelmässig - alle 60 Sekunden \\
\hline
\hline    
	\textbf{URL:} & /api/postlog \\
	\textbf{Request:} & Method: POST
		\newline Content-Type: application/json
		\newline Body: JSON-String 'TourLiveLog' \\
	\textbf{Response:} &  Header: HTTP/1.1 200 OK
		\newline Body: <empty>	\\
	\textbf{Eigenschaft:} &  Wird regelmässig als Service ausgeführt.\\ 
	\textbf{Interval:} &  regelmässig - alle 60 Sekunden\\
\hline
\hline 
	\textbf{URL:} & /api/getMsg/\{deviceId\} \\
	\textbf{Request:} & Method: GET
		\newline Body: <empty> \\
	\textbf{Response:} & Method: POST
		\newline Content-Type: application/json
		\newline Body: JSON-String 'Message' \\
	\textbf{Eigenschaft:} &  Wenn das 'messageAvailable'-Flag gesetzt ist in einem empfangenen DeviceManagementContainer. \\
	\textbf{Interval:} & unregelmässig\\
\hline
\hline 

\caption{Schnittstellen DeviceManagement Portal Übersicht}
\end{longtable} }

\subsection{Status posten und Einstellungen erhalten}

Um den aktuellen Status des Aufnahmesystems dem Server mitzuteilen kann diese Methode aufgerufen werden. Als Antwort erhält man die im Moment aktuellen Einstellungen.

{\bf URL: }http://tlng.cnlab.ch/devmgmtsrv/api/getdevicemanagementcontainer 

\subsubsection{Status JSON}

Das JSON eines Status Posts sieht folgendermassen aus:

\begin{figure}[H]
	\centering
	\lstinputlisting[language=json]{jsonfiles/status.json}
	\caption{Status JSON}
\end{figure}


\subsubsection{Einstellungen JSON}

Die Antwort die man bei dieser Anfrage erhält ist die folgende:

\begin{figure}[H]
	\centering
	\lstinputlisting[language=json]{jsonfiles/settings.json}
	\caption{Einstellungen JSON}
\end{figure}


\subsection{Log posten}

Um neue Logeinträge dem Server zu übermitteln kann diese Methode benutzt werden.

{\bf URL: }http://tlng.cnlab.ch/devmgmtsrv/api/postlog

\subsubsection{Log JSON}

Das JSON eines Log Posts sieht folgendermassen aus:

\begin{figure}[H]
	\centering
	\lstinputlisting[language=json]{jsonfiles/log.json}
	\caption{Log JSON}
\end{figure}

\subsection{Nachricht abholen}

Sofern eine neue Nachricht für das Gerät vorhanden ist kann sie über diese Methoden abgeholt werden.

{\bf URL: }http://tlng.cnlab.ch/devmgmtsrv/api/getmsg/{deviceId}

\subsubsection{Nachrichten JSON}
Das JSON für die Nachrichten ist das folgende:
\begin{figure}[H]
	\centering
	\lstinputlisting[language=json]{jsonfiles/message.json}
	\caption{Nachrichten JSON}
\end{figure}


